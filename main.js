!function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}({0:function(e,t,s){"use strict";s.r(t);var r;s(5);!function(e){e[e.INFO=0]="INFO",e[e.ERROR=1]="ERROR"}(r||(r={}));class n{log(e,t){t===r.ERROR?console.error(e):console.log(e)}}class a extends n{constructor(){super(),this._HTMLNode=document.querySelector(".log")}set HTMLNode(e){this._HTMLNode=e}log(e,t){super.log(e,t),this._HTMLNode&&(this._HTMLNode.innerHTML+=`${e} <br>`)}}class i{constructor(e){this._value=e,this.observers=[]}next(e){this._value=e,this.notifyObservers(e)}getValue(){return this._value}registerObserver(e){this.observers.push(e)}removeObserver(e){this.observers.splice(this.observers.indexOf(e),1)}notifyObservers(e){this.observers.forEach(t=>{t.update(e)})}}const o="STORE";class c extends a{constructor(){if(super(),c._state=new i({}),this.state$=c._state,c._instance)throw new Error("only one Store is Allowed")}static createStore({dispatcher:e,state:t,callbacks:s}){c._instance.log(`${o} WAS CREATED`,r.INFO),c.dispatcher=e;for(let e in s)this.dispatcher.register(e,s[e]);return c._state.next(t),this._instance}get state(){return c._state.getValue()}changeEvent(e){const t=Object.keys(e),s=t.length?`${o} CHANGE ${t} KEYS`:"${TYPE} CHANGE EVENT FIRED WITH EMPTY PAYLOAD";this.log(s,r.INFO),t.length&&c._state.next(Object.assign(this.state,e))}}c._instance=new c;const l="DISPATCHER";class h extends a{constructor(){if(h._instance)return h._instance;super(),this._callbacks=new Map}register(e,t){this._callbacks.has(e)||this._callbacks.set(e,[]),this._callbacks.get(e).push(t),this.log(`${l} REGISTER ${e} CALLBACK`,r.INFO)}dispatch(e){this._callbacks.has(e.type)?this._callbacks.get(e.type).forEach(t=>{this.log(`${l} DISPATCH ${e.type} CALLBACK`,r.INFO),t(e.payload)}):this.log(`${l} DISPATCH ERRORS ON TYPE ${e.type} CALLBACK`,r.ERROR)}unregister(e,t){if(this._callbacks.has(e)){t<this._callbacks.get(e).length&&t>=0&&(this._callbacks.get(e).splice(t,1),this.log(`${l} UNREGISTER ${e} CALLBACK with index ${t}`,r.INFO))}}}h._instance=new h;const u="INPUT_ON_KEY_UP",d="DATA_IN_SEND_PROCESS",_="DATA_WAS_SENT",p="ERROR_DATA",b="BUTTON_CLICK",E=new h,g=c.createStore({dispatcher:E,state:{log:"",logList:[],currentData:"",data:"Здесь появится ответ сервера"},callbacks:{[b]:()=>{E.dispatch({type:d})},[u]:e=>{g.changeEvent({currentData:e})},[d]:()=>{(e=>new Promise((t,s)=>{let r=setTimeout(()=>{t(e),clearTimeout(r)},800)}))(g.state.currentData).then(e=>{E.dispatch({type:_,payload:e||"YOU SEND EMPTY DATA"})}).catch(e=>{E.dispatch({type:p})})},[_]:e=>{g.changeEvent({data:e})}}}),v="VIEW";new class extends a{constructor(e,t){super(),this.node=e,this._observable=t,this.keys={},this.node=e,this._observable=t,this._observable.registerObserver(this)}_render(e){for(let t of this.node.childNodes){const s=t.dataset.bind;void 0!==s&&(void 0!==this.keys[s]&&e[s]===this.keys[s]||(this.log(`${v} RENDER`,r.INFO),t.innerText=e[s],this.keys[s]=e[s]))}}render(e){this.template=e(),this.node.innerHTML=this.template,this._render(this._observable.getValue())}update(e){this._render(e)}}(document.querySelector(".view-stub__label"),g.state$).render(()=>'<div data-bind="data"></div>');const O=document.querySelector("input"),T=document.querySelector(".view-stub__apply"),y=new h;T.addEventListener("click",()=>{y.dispatch({type:b})}),O.addEventListener("keyup",function(){y.dispatch({type:u,payload:this.value})})},5:function(e,t){}});
//# sourceMappingURL=main.js.map